<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapepr 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="storeMapper">
	<resultMap id="storeResultSet" type="Store">
		<id property="PR_CODE" column="PR_CODE"/>
		<result property="ST_CATAGORY" column="ST_CATAGORY"/>
		<result property="PR_NAME" column="PR_NAME"/>
		<result property="PR_IF" column="PR_IF"/>
		<result property="PR_EVENT" column="PR_EVENT"/>
		<result property="ORIGIN" column="ORIGIN"/>
		<result property="PR_PRICE" column="PR_PRICE"/>
		<result property="SUBSCRIPTIONS" column="SUBSCRIPTIONS"/>
		<result property="STORE_PHOTO1" column="STORE_PHOTO1"/>
		<result property="STORE_PHOTO2" column="STORE_PHOTO2"/>
		<result property="STORE_PHOTO3" column="STORE_PHOTO3"/>
		<result property="DY_COMPANY" column="DY_COMPANY"/>
		<result property="PR_INF" column="PR_INF"/>
		<result property="SERVICE_CENTER" column="SERVICE_CENTER"/>
		<result property="PR_DATE" column="PR_DATE"/>
		<result property="PR_NOTICE" column="PR_NOTICE"/> 
		<result property="PR_STATUS" column="PR_STATUS"/>
		<result property="C_CODE" column="C_CODE"/>	
		<result property="SCOUNT" column="SCOUNT"/>	
		
	</resultMap>
 
	
	<!-- 
PR_CODE	VARCHAR2(30 BYTE)	No		1	제품코드
ST_CATAGORY	VARCHAR2(100 BYTE)	No		2	스토어카케고리
PR_NAME	VARCHAR2(100 BYTE)	No		3	제품명
PR_IF	VARCHAR2(1000 BYTE)	No		4	제품소개
PR_EVENT	VARCHAR2(100 BYTE)	Yes		5	이벤트소개
ORIGIN	VARCHAR2(100 BYTE)	No		6	원산지
PR_PRICE	VARCHAR2(100 BYTE)	No		7	가격
SUBSCRIPTIONS	VARCHAR2(2 BYTE)	No		8	구독여부
STORE_PHOTO1	VARCHAR2(100 BYTE)	Yes		9	대표이미지
STORE_PHOTO2	VARCHAR2(100 BYTE)	Yes		10	추가이미지
STORE_PHOTO3	VARCHAR2(100 BYTE)	Yes		11	추아이미지2
DY_COMPANY	VARCHAR2(100 BYTE)	No		12	택배사
PR_INF	VARCHAR2(800 BYTE)	No		13	제품기능
SERVICE_CENTER	VARCHAR2(100 BYTE)	Yes		14	고객센터
PR_DATE	DATE	No	"SYSDATE	"	15	등록일
PR_NOTICE	VARCHAR2(1000 BYTE)	Yes		16	유의사항
PR_STATUS	VARCHAR2(2 BYTE)	Yes	"'N'	"	17	블라인드여부
C_CODE	VARCHAR2(30 BYTE)	No		18	카페코드
 -->
	
	<select id="selectListCount" resultType="_int">
		SELECT 
		       COUNT(*)
		  FROM
		       PRODUCT
		 WHERE
		       PR_STATUS = 'Y'
	</select> 
	
	

	
	<select id="selectSearchCount"  parameterType="Search" resultType="_int"  >
	  <bind name="sv" value="'%' + _parameter.getSearchValue() + '%'"/>  
	 
		SELECT 
		       COUNT(*)
		  FROM
		       PRODUCT
	   <where> 
			<choose>
				<when test="searchCondition == 'title'">
				AND 
					PR_NAME LIKE #{sv}
				AND 
					PR_STATUS = 'Y'
				</when>
				 
				<when test="searchCondition == 'category'">
				AND 
					ST_CATAGORY LIKE #{sv}
				AND 
					PR_STATUS = 'Y'
				</when>
				<otherwise>
				 
				</otherwise>
			</choose>
		</where>
	</select> 
	
	
	<select id="selectList" resultMap="storeResultSet">
		 SELECT
		       PR_CODE
		     , ST_CATAGORY
		     , PR_NAME
		     , PR_IF
		     , PR_EVENT
		     , ORIGIN
		     , PR_PRICE
		     , SUBSCRIPTIONS
		     , STORE_PHOTO1
		     , STORE_PHOTO2
		     , STORE_PHOTO3
		     , DY_COMPANY
		     , PR_INF
		     , SERVICE_CENTER
		     , PR_DATE
	         , PR_NOTICE 
      		 , PR_STATUS
      		 , C_CODE
      		 , SCOUNT
		          
		  FROM
		       PRODUCT
               JOIN CAFE USING(C_CODE)  
		 WHERE
		       PR_STATUS = 'Y' 
	  ORDER BY
	           PR_CODE DESC
	</select>
	
	<!--  추천상품 리스트 (조회수루 적용) -->
	<select id="selectList2" resultMap="storeResultSet">
				SELECT
		       PR_CODE
		     , ST_CATAGORY
		     , PR_NAME
		     , PR_IF
		     , PR_EVENT
		     , ORIGIN
		     , PR_PRICE
		     , SUBSCRIPTIONS
		     , STORE_PHOTO1
		     , STORE_PHOTO2
		     , STORE_PHOTO3
		     , DY_COMPANY
		     , PR_INF
		     , SERVICE_CENTER
		     , PR_DATE
	         , PR_NOTICE 
      		 , PR_STATUS
      		 , C_CODE
      		 , SCOUNT
		          
		  FROM
		       (SELECT
		               *
		          FROM
		               PRODUCT
		         WHERE
		               PR_STATUS = 'Y'
		      ORDER BY
		                SCOUNT DESC 
		       )		
		 WHERE
		 	    ROWNUM <![CDATA[<=]]> 3
		 	  
	</select>
	
	<!-- 나의 페이지 조회 -->
	<select id="myselectList" resultMap="storeResultSet">
	 SELECT	
		       PR_CODE
		     , ST_CATAGORY
		     , PR_NAME
		     , PR_IF
		     , PR_EVENT
		     , ORIGIN
		     , PR_PRICE
		     , SUBSCRIPTIONS
		     , STORE_PHOTO1
		     , STORE_PHOTO2
		     , STORE_PHOTO3
		     , DY_COMPANY
		     , PR_INF
		     , SERVICE_CENTER
		     , PR_DATE
	         , PR_NOTICE 
      		 , PR_STATUS
      		 , C_CODE
      		 , SCOUNT
		          
		  FROM
		       PRODUCT
               JOIN CAFE USING(C_CODE)  
		 WHERE
		       ID = #{id}
		   AND 
				PR_STATUS = 'Y'
	  ORDER BY
	           PR_CODE DESC  
	</select>
	
	 <!-- 내가 쓴글 카운트 -->
	<select id="mySearchCount" resultType="_int"  > 
		SELECT 
		       COUNT(*)
		  FROM
		       PRODUCT
		       JOIN CAFE USING(C_CODE)  
		 WHERE
		        ID = #{id}
		    AND 
				PR_STATUS = 'Y'
	</select> 
	 
 
	<select id="searchList"   parameterType="Search" resultMap="storeResultSet">
	  <bind name="sv" value="'%' + _parameter.getSearchValue() + '%'"/>  
		SELECT
		       PR_CODE
		     , ST_CATAGORY
		     , PR_NAME
		     , PR_IF
		     , PR_EVENT
		     , ORIGIN
		     , PR_PRICE
		     , SUBSCRIPTIONS
		     , STORE_PHOTO1
		     , STORE_PHOTO2
		     , STORE_PHOTO3
		     , DY_COMPANY
		     , PR_INF
		     , SERVICE_CENTER
		     , PR_DATE
	         , PR_NOTICE 
      		 , PR_STATUS
      		 , SCOUNT 
		  FROM
		        (SELECT
		               *
		          FROM
		               PRODUCT
		         WHERE
		               PR_STATUS = 'Y'
		      ORDER BY
		                PR_CODE  
		       )		
		<where>
			 
			<choose>
				<when test="searchCondition == 'title'">
				AND 
					PR_NAME LIKE #{sv}
				AND 
					PR_STATUS = 'Y'
				</when>
				 
				<when test="searchCondition == 'category'">
				AND 
					ST_CATAGORY LIKE #{sv}
				AND 
					PR_STATUS = 'Y'
				</when>
				<otherwise>
				 
				</otherwise>
			</choose>
		</where>
		 
	</select>
	
	<select id="selectStore" parameterType="_int" resultMap="storeResultSet">
		SELECT
		       PR_CODE
		     , ST_CATAGORY
		     , PR_NAME
		     , PR_IF
		     , PR_EVENT
		     , ORIGIN
		     , PR_PRICE
		     , SUBSCRIPTIONS
		     , STORE_PHOTO1
		     , STORE_PHOTO2
		     , STORE_PHOTO3
		     , DY_COMPANY
		     , PR_INF
		     , SERVICE_CENTER
		     , PR_DATE
	         , PR_NOTICE 
      		 , PR_STATUS
      		 , C_CODE
      		 , SCOUNT
		          
		  FROM
		       PRODUCT
		 WHERE
		 	   PR_CODE = #{PR_CODE}
		 AND
		       PR_STATUS = 'Y' 
	</select>
	
	<!--  조회수 증가시켜 조회수많은 제품 추천상품 등록 -->
	<update id="updateReadCount" parameterType="_int">
		UPDATE
		        PRODUCT
		   SET
		       SCOUNT = SCOUNT + 1
		 WHERE
		       PR_CODE = #{PR_CODE}
	</update>
	
	
	
	<insert id="insertStore" parameterType="string">
		INSERT
		INTO PRODUCT
		(
		       PR_CODE
		     , ST_CATAGORY
		     , PR_NAME
		     , PR_IF
		     , PR_EVENT
		     , ORIGIN
		     , PR_PRICE
		     , SUBSCRIPTIONS
		     , STORE_PHOTO1
		     , STORE_PHOTO2
		     , STORE_PHOTO3
		     , DY_COMPANY
		     , PR_INF
		     , SERVICE_CENTER
		     , PR_DATE
	         , PR_NOTICE 
      		 , PR_STATUS
      		 , C_CODE
      		 , SCOUNT
		          
		 	)
		VALUES
		(
			STA.NEXTVAL
			,#{ST_CATAGORY}
			,#{PR_NAME}
			,#{PR_IF}
			,#{PR_EVENT}
			,#{ORIGIN}
			,#{PR_PRICE}
			,#{SUBSCRIPTIONS}
			,#{STORE_PHOTO1}
			,#{STORE_PHOTO2}
			,#{STORE_PHOTO3}
			,#{DY_COMPANY}
			,#{PR_INF}
			,#{SERVICE_CENTER}
			, SYSDATE
			,#{PR_NOTICE }
			, 'Y'
			, (SELECT C_CODE
					FROM
   				 CAFE
 				WHERE
   				 ID= #{C_CODE})
			, 0 
		)
	
	</insert>
	
	<update id="updateStore" parameterType="Store">
		UPDATE 
		       PRODUCT
		   SET    
		       ST_CATAGORY = #{ ST_CATAGORY }
		     , PR_NAME = #{ PR_NAME }
		     , PR_IF = #{ PR_IF  }
		     , PR_EVENT = #{ PR_EVENT }
		     , ORIGIN = #{ ORIGIN }
		     , PR_PRICE = #{ PR_PRICE } 
		     , STORE_PHOTO1 = #{ STORE_PHOTO1 }
		     , STORE_PHOTO2 = #{ STORE_PHOTO2 }
		     , STORE_PHOTO3 = #{ STORE_PHOTO3 }
		     , DY_COMPANY = #{ DY_COMPANY }
		     , PR_INF = #{ PR_INF }
		     , SERVICE_CENTER = #{ SERVICE_CENTER } 
	         , PR_NOTICE = #{ PR_NOTICE }
		 WHERE 
		       PR_CODE = #{ PR_CODE }
	</update>
	
	 <update id="deleteStore" parameterType="_int">
		UPDATE 
		       PRODUCT
		   SET 
		       PR_STATUS = 'N'
		 WHERE 
		      PR_CODE = #{PR_CODE}
	</update>
	
	
	 
</mapper>